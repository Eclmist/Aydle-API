var engine = require('AydleEngine/AydleEngine');
var gameLoop = engine.GameLoop;

function PassTheBomb(){}

let data = JSON.parse(process.argv[2]);

let socket = data.socket;
let io = data.io;

let gamerunning = false;
let targetNumber = -1;
let timeleft = 30.0;

gameLoop.setPrepare(start);
gameLoop.setUpdate(update);
gameLoop.start();

function start(){
	console.log('Pass The Bomb started');
	gamerunning = true;
    
    socket.on('pass', (time, number) => {
		if (number === targetNumber) {

			let timer = time

			timeleft = timer
			targetNumber = getRandNumber(1, 10)
			io.in(socket.currentRoom.code).emit('PassBomb', socket.currentRoom.GetNextTarget().playerID, timer, targetNumber)
		}
	})

	socket.on('generate', () => {
		socket.emit('newRandomNumber', getRandNumber(1,10))
	});
	
}

function update(){
    if(gamerunning === true){
        timeleft -= gameLoop.getDeltaTime();
        
            if (timeleft <= 0) {		
				io.in(socket.currentRoom.code).emit('explode')
				gamerunning = false
				timeleft = 30
            }
            
    }
    else{
        process.exit(0);
    }

}

function getRandNumber(max, min) //both inclusive
{
	return Math.floor(Math.random() * (max - min + 1)) + min;
}


